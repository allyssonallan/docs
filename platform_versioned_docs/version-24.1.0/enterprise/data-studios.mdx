---
title: "Data Studios deployment"
description: Deploy Seqera Platform with Data studios
date: "12 Jun 2024"
tags: [docker, compose, kubernetes, data, studios, deployment]
---

## DNS configuration

The proxy domain (`CONNECT_PROXY_URL`) has to be a subdomain of main platform domain (example: if the platform domain is
`tower.io`, then the proxy domain should be `example.tower.io`).
Data Studios requires a wildcard DNS record that will match requests for non-existent subdomains.
It is specified by a `*` as part of the domain name, example: `*.tower.io`. It should be pointed to the port 9090.

Example of setup:
```
*.tower.io -> 9090
tower.io -> 8000
```

You must provide a valid wildcard TLS certificate for the third level domain.

:::note
We recommend using only a third-level domain if possible, as costs may increase with the number of subdomains.
:::

## Docker Compose

This guide assumes that all services will be run in the same container as the rest of your Seqera Platform services.

### Prerequisites

- Allow inbound traffic to port 9090 on EC2 instance
- Allow traffic on port 9090 through AWS LB
- An RSA private key in PEM format
- An AWS Route53 wildcard DNS record, such as `*.<seqera_platform_domain>`

### Procedure

1. Download the Data Studios `data-studios.env` environment configuration file.

1. Open `data-studios.env` in an editor, and make the following changes:
   1. Uncomment the `connect-proxy` and `connect-server` services.
   1. Set the following environment variables:
      - `TOWER_BASE_URL`
      - `INITIAL_ACCESS_TOKEN`
      - `CONNECT_PROXY_URL`

1. Edit your existing Seqera `tower.env` configuration file, and ensure that the following variables are set:

   - `TOWER_DATA_STUDIO_ALLOWED_WORKSPACES`
   - `TOWER_DATA_EXPLORER_ENABLED=true`
   - `TOWER_DATA_STUDIO_CONNECT_URL`
   - `TOWER_OIDC_REGISTRATION_INITIAL_ACCESS_TOKEN`
   - `TOWER_OIDC_PEM_PATH`

1. Open the `docker-compose.yml`, and uncomment the volume mount for the PEM key file for the `backend` service in the `volumes` list:

  ```yaml
      volumes:
        - $PWD/tower.yml:/tower.yml
        # Data studios RSA key is required for the data studios functionality. Uncomment the line below to mount the key.
        #- $PWD/data-studios-rsa.pem:/data-studios-rsa.pem
  ```

1. Start your Platform instance: `docker compose -d up`.

---

To run Data Studios in `docker compose` setup uncomment following values in the `_templates/docker/tower.env` file:

# Data studios settings
```yaml
TOWER_BASE_URL=<YOUR TOWER URL, IDENTICAL AS `TOWER_SERVER_URL` in `tower.env`>
CONNECT_HTTP_PORT=9090
TOWER_CONNECT_ADDRESS=connect-proxy:9090
TOWER_CONNECT_TUNNEL=connect-server:7070
REDIS_ADDRESS: redis:6379
CONNECT_PROXY_URL=<YOUR CONNECT URL, It has to be a subdomain of your tower domain, example: https://connect.tower.io >
INITIAL_ACCESS_TOKEN=<YOUR INITIAL ACCESS TOKEN, IDEANTICAL AS `TOWER_OIDC_REGISTRATION_INITIAL_ACCESS_TOKEN` in `tower.env`>
```

### Existing content

```dotenv
# Data Studios settings
TOWER_DATA_STUDIO_ALLOWED_WORKSPACES=<ALLOWED WORKSPACES>

# Enable Data Explorer to enable mounting data to your data studios
TOWER_DATA_EXPLORER_ENABLED=true
TOWER_DATA_EXPLORER_CLOUD_DISABLED_WORKSPACES=

TOWER_DATA_STUDIO_CONNECT_URL=<YOUR CONNECT URL, SAME AS `CONNECT_PROXY_URL` IN `data-studios.env` >
TOWER_OIDC_REGISTRATION_INITIAL_ACCESS_TOKEN=<YOUR INITIAL ACCESS TOKEN, IDENTICAL AS `INITIAL_ACCESS_TOKEN` in `data-studios.env`>
TOWER_OIDC_PEM_PATH=<PATH TO PEM FILE>
```

Fill in the values for `_templates/docker/data-studios.env` and uncomment the following lines in the `_templates/docker/docker-compose.yml` file:

```yaml
  connect-proxy:
    image: cr.seqera.io/private/nf-tower-enterprise/data-studio/tower-connect-proxy:0.6.14
    platform: linux/amd64
    env_file:
      - data-studios.env
    networks:
      - frontend
      - backend
    ports:
      - 9090:9090
    restart: always
    depends_on:
      - redis

  connect-server:
    image: cr.seqera.io/private/nf-tower-enterprise/data-studio/tower-connect-server:v0.6.14
    platform: linux/amd64
    env_file:
      - data-studios.env
    networks:
      - backend
    ports:
      - 7070:7070
    restart: always
```

An RSA key is required for the Data Studios functionality. Generate your key and provide the path to it in the
`TOWER_OIDC_PEM_PATH` variable in the `data-studios.env` file. Next mount the `pem` file in the `backend` service in the `docker-compose.yml` file.

See this example in the configuration with `data-studios-rsa.pem` file mounted in the `backend` service:
```yaml
  backend:
    volumes:
      - $PWD/data-studios-rsa.pem:/data-studios-rsa.pem
```


TBD for Docker?

This is required to enable for all organizational workspaces, provided the environment variable is entirely omitted.

```yaml
kind: ConfigMap
apiVersion: v1
metadata:
  name: platform-tower-yml
  namespace: platform-stage
  labels:
    app: backend-cfg
data:
  tower.yml: |-
    tower:
      data-studio:
        allowed-workspaces: null
```
